<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tidy Tuesday</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Data Analysis Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="./aboutme.html">About Me</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./rcoding.html">R Coding</a>
    </li>
    <li>
      <a href="./visualization.html">Visualization</a>
    </li>
    <li>
      <a href="./tidytuesday.html">Tidy Tuesday</a>
    </li>
    <li>
      <a href="./tidytuesday_exercise2.html">Tidy Tuesday 2 Exercise</a>
    </li>
    <li>
      <a href="./Flu_Analysis_Exploration.html">Flu Data Analysis: Exploration</a>
    </li>
    <li>
      <a href="./Flu_Analysis_Simple.html">Flu Data Analysis: Simple and Multivariate Regression</a>
    </li>
    <li>
      <a href="./Flu_Analysis_Complex.html">Flu Data Analysis: Machine Learning Techniques</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nicholasmallis/NicholasMallis-MADA-portfolio">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tidy Tuesday</h1>

</div>


<p>This is a Tidy Tuesday exercise that I did in a Modern Applied Data Analysis course at UGA with Dr. Andreas Handel. With this exercise, I use data on competitive marble racing, a recent youTube phenomena. You can find more information <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-02/readme.md">here at the github page</a></p>
<div id="data-import" class="section level2">
<h2>Data Import</h2>
<p>The following chunk of code loads packages and imports the data. I also use skim() to get some quick decriptive statistics on the data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(tidytuesdayR)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(skimr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(janitor)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(broom)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">library</span>(here) <span class="co">#for data loading/saving</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw">library</span>(recipes)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">library</span>(tidymodels)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw">library</span>(workflowr) </span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="kw">library</span>(parsnip)</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">library</span>(rsample)</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="kw">library</span>(rpart)</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="kw">library</span>(ranger)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="kw">library</span>(modeldata)</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="kw">library</span>(rpart.plot)</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw">library</span>(dials)</span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="kw">library</span>(workflows)</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="kw">library</span>(vip)</span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="kw">library</span>(yardstick)</span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="kw">library</span>(doParallel) <span class="co"># for parallel computing </span></span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co"># Get the Data</span></span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a>marbles &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-02/marbles.csv&#39;</span>)</span></code></pre></div>
<pre><code>## Rows: 256 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (9): date, race, site, source, marble_name, team_name, pole, host, notes
## dbl (5): time_s, points, track_length_m, number_laps, avg_time_lap</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">glimpse</span>(marbles)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 14
## $ date           &lt;chr&gt; &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15…
## $ race           &lt;chr&gt; &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;,…
## $ site           &lt;chr&gt; &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;…
## $ source         &lt;chr&gt; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot;, &quot;https://youtu.be…
## $ marble_name    &lt;chr&gt; &quot;Clementin&quot;, &quot;Starry&quot;, &quot;Momo&quot;, &quot;Yellow&quot;, &quot;Snowy&quot;, &quot;Razz…
## $ team_name      &lt;chr&gt; &quot;O&#39;rangers&quot;, &quot;Team Galactic&quot;, &quot;Team Momo&quot;, &quot;Mellow Yell…
## $ time_s         &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11,…
## $ pole           &lt;chr&gt; &quot;P1&quot;, &quot;P2&quot;, &quot;P3&quot;, &quot;P4&quot;, &quot;P5&quot;, &quot;P6&quot;, &quot;P7&quot;, &quot;P8&quot;, &quot;P9&quot;, &quot;…
## $ points         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ track_length_m &lt;dbl&gt; 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81,…
## $ number_laps    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 10, 10,…
## $ avg_time_lap   &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11,…
## $ host           &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;…
## $ notes          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">head</span>(marbles)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   date      race  site    source      marble_name team_name  time_s pole  points
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 15-Feb-20 S1Q1  Savage… https://yo… Clementin   O&#39;rangers    28.1 P1        NA
## 2 15-Feb-20 S1Q1  Savage… https://yo… Starry      Team Gala…   28.4 P2        NA
## 3 15-Feb-20 S1Q1  Savage… https://yo… Momo        Team Momo    28.4 P3        NA
## 4 15-Feb-20 S1Q1  Savage… https://yo… Yellow      Mellow Ye…   28.7 P4        NA
## 5 15-Feb-20 S1Q1  Savage… https://yo… Snowy       Snowballs    28.7 P5        NA
## 6 15-Feb-20 S1Q1  Savage… https://yo… Razzy       Raspberry…   28.7 P6        NA
## # … with 5 more variables: track_length_m &lt;dbl&gt;, number_laps &lt;dbl&gt;,
## #   avg_time_lap &lt;dbl&gt;, host &lt;chr&gt;, notes &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">tail</span>(marbles)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   date     race  site         source   marble_name team_name time_s pole  points
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 5-Apr-20 S1R8  Midnight Bay https:/… Wospy       Midnight…   483. &lt;NA&gt;       0
## 2 5-Apr-20 S1R8  Midnight Bay https:/… Clementin   O&#39;rangers   483. &lt;NA&gt;       0
## 3 5-Apr-20 S1R8  Midnight Bay https:/… Yellup      Mellow Y…   483. &lt;NA&gt;       0
## 4 5-Apr-20 S1R8  Midnight Bay https:/… Hive        Hornets     484. &lt;NA&gt;       0
## 5 5-Apr-20 S1R8  Midnight Bay https:/… Starry      Team Gal…   485. &lt;NA&gt;       0
## 6 5-Apr-20 S1R8  Midnight Bay https:/… Sublime     Limers      492. &lt;NA&gt;       0
## # … with 5 more variables: track_length_m &lt;dbl&gt;, number_laps &lt;dbl&gt;,
## #   avg_time_lap &lt;dbl&gt;, host &lt;chr&gt;, notes &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>skimr<span class="op">::</span><span class="kw">skim</span>(marbles)</span></code></pre></div>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">marbles</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">256</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">9</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">8</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">race</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">site</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">34</td>
<td align="right">34</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">marble_name</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">32</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">team_name</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pole</td>
<td align="right">128</td>
<td align="right">0.50</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">host</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">notes</td>
<td align="right">249</td>
<td align="right">0.03</td>
<td align="right">37</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">time_s</td>
<td align="right">3</td>
<td align="right">0.99</td>
<td align="right">190.84</td>
<td align="right">169.13</td>
<td align="right">17.76</td>
<td align="right">28.40</td>
<td align="right">36.28</td>
<td align="right">338.16</td>
<td align="right">492.01</td>
<td align="left">▇▁▁▇▁</td>
</tr>
<tr class="even">
<td align="left">points</td>
<td align="right">128</td>
<td align="right">0.50</td>
<td align="right">6.45</td>
<td align="right">7.74</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">3.00</td>
<td align="right">11.25</td>
<td align="right">26.00</td>
<td align="left">▇▂▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">track_length_m</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">13.22</td>
<td align="right">0.95</td>
<td align="right">11.90</td>
<td align="right">12.62</td>
<td align="right">13.02</td>
<td align="right">14.13</td>
<td align="right">14.55</td>
<td align="left">▅▅▂▁▇</td>
</tr>
<tr class="even">
<td align="left">number_laps</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6.25</td>
<td align="right">5.53</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.25</td>
<td align="right">16.00</td>
<td align="left">▇▁▃▂▂</td>
</tr>
<tr class="odd">
<td align="left">avg_time_lap</td>
<td align="right">3</td>
<td align="right">0.99</td>
<td align="right">29.70</td>
<td align="right">5.55</td>
<td align="right">17.76</td>
<td align="right">25.94</td>
<td align="right">30.05</td>
<td align="right">33.65</td>
<td align="right">41.62</td>
<td align="left">▃▆▇▇▂</td>
</tr>
</tbody>
</table>
<p>Exploring Data: First I want to check on some simple characteristics of the data like how many races were collected, how many teams, how many marbles, and how many marbles per team.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># how many teams hosted</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>host)</span></code></pre></div>
<pre><code>## 
##  No Yes 
## 240  16</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># examining which teams hosted</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>host, marbles<span class="op">$</span>team_name)</span></code></pre></div>
<pre><code>##      
##       Balls of Chaos Green Ducks Hazers Hornets Limers Mellow Yellow
##   No              16          14     16      14     16            16
##   Yes              0           2      0       2      0             0
##      
##       Midnight Wisps O&#39;rangers Raspberry Racers Rojo Rollers Savage Speeders
##   No              15        14               13           16              14
##   Yes              1         2                3            0               2
##      
##       Snowballs Team Galactic Team Momo Team Primary Thunderbolts
##   No         16            16        14           16           14
##   Yes         0             0         2            0            2</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># How many sites?</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>site)</span></code></pre></div>
<pre><code>## 
##      Greenstone       Hivedrive    Midnight Bay      Momotorway       O&#39;raceway 
##              32              32              32              32              32 
##         Razzway Savage Speedway   Short Circuit 
##              32              32              32</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># How many races? Looks here like we have an equal number of observations per race with 16 total races</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>race)</span></code></pre></div>
<pre><code>## 
## S1Q1 S1Q2 S1Q3 S1Q4 S1Q5 S1Q6 S1Q7 S1Q8 S1R1 S1R2 S1R3 S1R4 S1R5 S1R6 S1R7 S1R8 
##   16   16   16   16   16   16   16   16   16   16   16   16   16   16   16   16</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">#number of teams. 16 teams</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>team_name)</span></code></pre></div>
<pre><code>## 
##   Balls of Chaos      Green Ducks           Hazers          Hornets 
##               16               16               16               16 
##           Limers    Mellow Yellow   Midnight Wisps        O&#39;rangers 
##               16               16               16               16 
## Raspberry Racers     Rojo Rollers  Savage Speeders        Snowballs 
##               16               16               16               16 
##    Team Galactic        Team Momo     Team Primary     Thunderbolts 
##               16               16               16               16</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">#And an equal number of teams in each race</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">table</span>(marbles<span class="op">$</span>race, marbles<span class="op">$</span>team_name)</span></code></pre></div>
<pre><code>##       
##        Balls of Chaos Green Ducks Hazers Hornets Limers Mellow Yellow
##   S1Q1              1           1      1       1      1             1
##   S1Q2              1           1      1       1      1             1
##   S1Q3              1           1      1       1      1             1
##   S1Q4              1           1      1       1      1             1
##   S1Q5              1           1      1       1      1             1
##   S1Q6              1           1      1       1      1             1
##   S1Q7              1           1      1       1      1             1
##   S1Q8              1           1      1       1      1             1
##   S1R1              1           1      1       1      1             1
##   S1R2              1           1      1       1      1             1
##   S1R3              1           1      1       1      1             1
##   S1R4              1           1      1       1      1             1
##   S1R5              1           1      1       1      1             1
##   S1R6              1           1      1       1      1             1
##   S1R7              1           1      1       1      1             1
##   S1R8              1           1      1       1      1             1
##       
##        Midnight Wisps O&#39;rangers Raspberry Racers Rojo Rollers Savage Speeders
##   S1Q1              1         1                1            1               1
##   S1Q2              1         1                1            1               1
##   S1Q3              1         1                1            1               1
##   S1Q4              1         1                1            1               1
##   S1Q5              1         1                1            1               1
##   S1Q6              1         1                1            1               1
##   S1Q7              1         1                1            1               1
##   S1Q8              1         1                1            1               1
##   S1R1              1         1                1            1               1
##   S1R2              1         1                1            1               1
##   S1R3              1         1                1            1               1
##   S1R4              1         1                1            1               1
##   S1R5              1         1                1            1               1
##   S1R6              1         1                1            1               1
##   S1R7              1         1                1            1               1
##   S1R8              1         1                1            1               1
##       
##        Snowballs Team Galactic Team Momo Team Primary Thunderbolts
##   S1Q1         1             1         1            1            1
##   S1Q2         1             1         1            1            1
##   S1Q3         1             1         1            1            1
##   S1Q4         1             1         1            1            1
##   S1Q5         1             1         1            1            1
##   S1Q6         1             1         1            1            1
##   S1Q7         1             1         1            1            1
##   S1Q8         1             1         1            1            1
##   S1R1         1             1         1            1            1
##   S1R2         1             1         1            1            1
##   S1R3         1             1         1            1            1
##   S1R4         1             1         1            1            1
##   S1R5         1             1         1            1            1
##   S1R6         1             1         1            1            1
##   S1R7         1             1         1            1            1
##   S1R8         1             1         1            1            1</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># number of individual marbles. 31. Tabling this, we see that not every marble</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co"># raced in every event. It looks like they had to qualify to race</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="kw">table</span>(marbles<span class="op">$</span>marble_name)</span></code></pre></div>
<pre><code>## 
##   Anarchy     Billy      Bolt Clementin   Clutter      Hazy      Hive  Limelime 
##         8         8         8         8         8         8         8         8 
##   Mallard      Mary      Mimo      Momo   Orangin      Prim    Pulsar   Rapidly 
##         8         8         8         8         8         8         8         8 
##     Razzy     Rezzy  Rojo Dos  Rojo Uno     Shock    Smoggy Snowflake     Snowy 
##         8         8         8         8         8         8         8         8 
##    Speedy    Starry   Sublime     Vespa     Wispy     Wospy    Yellow    Yellup 
##         8         8         8         8         8         8         8         8</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">table</span>(marbles<span class="op">$</span>marble_name, marbles<span class="op">$</span>race)</span></code></pre></div>
<pre><code>##            
##             S1Q1 S1Q2 S1Q3 S1Q4 S1Q5 S1Q6 S1Q7 S1Q8 S1R1 S1R2 S1R3 S1R4 S1R5
##   Anarchy      0    1    0    1    0    1    1    0    0    1    0    1    0
##   Billy        0    1    0    1    0    1    1    0    0    1    0    1    0
##   Bolt         0    1    0    1    1    0    0    1    0    1    0    1    1
##   Clementin    1    0    1    0    0    1    0    1    1    0    1    0    0
##   Clutter      1    0    1    0    1    0    0    1    1    0    1    0    1
##   Hazy         1    0    1    0    1    0    0    1    1    0    1    0    1
##   Hive         0    1    0    1    1    0    0    1    0    1    0    1    1
##   Limelime     0    1    0    1    1    0    1    0    0    1    0    1    1
##   Mallard      1    0    1    0    1    0    0    1    1    0    1    0    1
##   Mary         0    1    0    1    1    0    1    0    0    1    0    1    1
##   Mimo         0    1    0    1    0    1    1    0    0    1    0    1    0
##   Momo         1    0    1    0    1    0    0    1    1    0    1    0    1
##   Orangin      0    1    0    1    1    0    1    0    0    1    0    1    1
##   Prim         1    0    1    0    0    1    0    1    1    0    1    0    0
##   Pulsar       0    1    0    1    0    1    1    0    0    1    0    1    0
##   Rapidly      0    1    0    1    1    0    1    0    0    1    0    1    1
##   Razzy        1    0    1    0    0    1    1    0    1    0    1    0    0
##   Rezzy        0    1    0    1    1    0    0    1    0    1    0    1    1
##   Rojo Dos     0    1    0    1    0    1    1    0    0    1    0    1    0
##   Rojo Uno     1    0    1    0    1    0    0    1    1    0    1    0    1
##   Shock        1    0    1    0    0    1    1    0    1    0    1    0    0
##   Smoggy       0    1    0    1    0    1    1    0    0    1    0    1    0
##   Snowflake    0    1    0    1    1    0    1    0    0    1    0    1    1
##   Snowy        1    0    1    0    0    1    0    1    1    0    1    0    0
##   Speedy       1    0    1    0    0    1    0    1    1    0    1    0    0
##   Starry       1    0    1    0    1    0    0    1    1    0    1    0    1
##   Sublime      1    0    1    0    0    1    0    1    1    0    1    0    0
##   Vespa        1    0    1    0    0    1    1    0    1    0    1    0    0
##   Wispy        1    0    1    0    0    1    1    0    1    0    1    0    0
##   Wospy        0    1    0    1    1    0    0    1    0    1    0    1    1
##   Yellow       1    0    1    0    0    1    1    0    1    0    1    0    0
##   Yellup       0    1    0    1    1    0    0    1    0    1    0    1    1
##            
##             S1R6 S1R7 S1R8
##   Anarchy      1    1    0
##   Billy        1    1    0
##   Bolt         0    0    1
##   Clementin    1    0    1
##   Clutter      0    0    1
##   Hazy         0    0    1
##   Hive         0    0    1
##   Limelime     0    1    0
##   Mallard      0    0    1
##   Mary         0    1    0
##   Mimo         1    1    0
##   Momo         0    0    1
##   Orangin      0    1    0
##   Prim         1    0    1
##   Pulsar       1    1    0
##   Rapidly      0    1    0
##   Razzy        1    1    0
##   Rezzy        0    0    1
##   Rojo Dos     1    1    0
##   Rojo Uno     0    0    1
##   Shock        1    1    0
##   Smoggy       1    1    0
##   Snowflake    0    1    0
##   Snowy        1    0    1
##   Speedy       1    0    1
##   Starry       0    0    1
##   Sublime      1    0    1
##   Vespa        1    1    0
##   Wispy        1    1    0
##   Wospy        0    0    1
##   Yellow       1    1    0
##   Yellup       0    0    1</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># exploring missing data</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co">#there are a lot missing with the points variable seen below</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(marbles<span class="op">$</span>points))</span></code></pre></div>
<pre><code>## [1] 128</code></pre>
<p>Descriptive Questions: Which marble performs the best (has the lowest median race time)? Which team performs the best? Since the races are all different lengths, I standardize the race times similar to how they did in the paper linked on the github. I first calculate the average race time for each specific race and then divide each marble’s time by the average to get the standard.Then I calculate the median race time by marble and by team</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co">#marbles$qual &lt;- grepl(&#39;Q&#39;, marbles$race, fixed = TRUE)</span></span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co">#first standardizing race...</span></span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co">#calculating average time by race and saving as a new df</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>av_race_times &lt;-<span class="st"> </span>marbles <span class="op">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="st">  </span><span class="kw">group_by</span>(race) <span class="op">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">mean_race_time =</span> <span class="kw">mean</span>(time_s, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span>
<span id="cb33-10"><a href="#cb33-10"></a></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="co">#then repeating measures for merging</span></span>
<span id="cb33-12"><a href="#cb33-12"></a>av_race_times &lt;-<span class="st"> </span>av_race_times[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(av_race_times)), <span class="dt">each =</span> <span class="dv">16</span>), ]</span>
<span id="cb33-13"><a href="#cb33-13"></a></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="co">#merging with original set on id</span></span>
<span id="cb33-15"><a href="#cb33-15"></a></span>
<span id="cb33-16"><a href="#cb33-16"></a><span class="co">#but first a sort</span></span>
<span id="cb33-17"><a href="#cb33-17"></a>marbles&lt;-<span class="st"> </span>marbles[</span>
<span id="cb33-18"><a href="#cb33-18"></a>  <span class="kw">with</span>(marbles, <span class="kw">order</span>(race)),</span>
<span id="cb33-19"><a href="#cb33-19"></a>]</span>
<span id="cb33-20"><a href="#cb33-20"></a></span>
<span id="cb33-21"><a href="#cb33-21"></a></span>
<span id="cb33-22"><a href="#cb33-22"></a><span class="co">#</span></span>
<span id="cb33-23"><a href="#cb33-23"></a>marbles_new &lt;-<span class="st"> </span><span class="kw">cbind</span>(marbles, av_race_times<span class="op">$</span>mean_race_time)</span>
<span id="cb33-24"><a href="#cb33-24"></a></span>
<span id="cb33-25"><a href="#cb33-25"></a><span class="kw">glimpse</span>(marbles_new)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 15
## $ date                           &lt;chr&gt; &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, …
## $ race                           &lt;chr&gt; &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;,…
## $ site                           &lt;chr&gt; &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;, &quot;…
## $ source                         &lt;chr&gt; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot;, &quot;…
## $ marble_name                    &lt;chr&gt; &quot;Clementin&quot;, &quot;Starry&quot;, &quot;Momo&quot;, &quot;Yellow&quot;…
## $ team_name                      &lt;chr&gt; &quot;O&#39;rangers&quot;, &quot;Team Galactic&quot;, &quot;Team Mom…
## $ time_s                         &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.7…
## $ pole                           &lt;chr&gt; &quot;P1&quot;, &quot;P2&quot;, &quot;P3&quot;, &quot;P4&quot;, &quot;P5&quot;, &quot;P6&quot;, &quot;P7…
## $ points                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ track_length_m                 &lt;dbl&gt; 12.81, 12.81, 12.81, 12.81, 12.81, 12.8…
## $ number_laps                    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ avg_time_lap                   &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.7…
## $ host                           &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No…
## $ notes                          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ `av_race_times$mean_race_time` &lt;dbl&gt; 29.44000, 29.44000, 29.44000, 29.44000,…</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co">#let&#39;s rename that one...</span></span>
<span id="cb35-2"><a href="#cb35-2"></a></span>
<span id="cb35-3"><a href="#cb35-3"></a>marbles_new &lt;-<span class="st"> </span><span class="kw">rename</span>(marbles_new, <span class="dt">average_by_race =</span> <span class="st">`</span><span class="dt">av_race_times$mean_race_time</span><span class="st">`</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co">#marbles_new &lt;- marbles_new[which(marbles_new$qual == FALSE),  ]</span></span>
<span id="cb35-6"><a href="#cb35-6"></a></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co">#calculating standard like they did in paper</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>marbles_new &lt;-<span class="st"> </span>marbles_new  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb35-9"><a href="#cb35-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">standard_time=</span> time_s<span class="op">/</span>average_by_race)</span>
<span id="cb35-10"><a href="#cb35-10"></a></span>
<span id="cb35-11"><a href="#cb35-11"></a><span class="kw">glimpse</span>(marbles_new)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 16
## $ date            &lt;chr&gt; &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;1…
## $ race            &lt;chr&gt; &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;…
## $ site            &lt;chr&gt; &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;, &quot;Savage Speedway…
## $ source          &lt;chr&gt; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot;, &quot;https://youtu.b…
## $ marble_name     &lt;chr&gt; &quot;Clementin&quot;, &quot;Starry&quot;, &quot;Momo&quot;, &quot;Yellow&quot;, &quot;Snowy&quot;, &quot;Raz…
## $ team_name       &lt;chr&gt; &quot;O&#39;rangers&quot;, &quot;Team Galactic&quot;, &quot;Team Momo&quot;, &quot;Mellow Yel…
## $ time_s          &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11…
## $ pole            &lt;chr&gt; &quot;P1&quot;, &quot;P2&quot;, &quot;P3&quot;, &quot;P4&quot;, &quot;P5&quot;, &quot;P6&quot;, &quot;P7&quot;, &quot;P8&quot;, &quot;P9&quot;, …
## $ points          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ track_length_m  &lt;dbl&gt; 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81…
## $ number_laps     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ avg_time_lap    &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11…
## $ host            &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, …
## $ notes           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ average_by_race &lt;dbl&gt; 29.44000, 29.44000, 29.44000, 29.44000, 29.44000, 29.4…
## $ standard_time   &lt;dbl&gt; 0.9548234, 0.9636549, 0.9646739, 0.9748641, 0.9752038,…</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">#creating a new median variable by marble for plotting in order</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>med_st &lt;-<span class="st"> </span>marbles_new  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="st">  </span><span class="kw">group_by</span>(marble_name) <span class="op">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">med_st_time =</span> <span class="kw">median</span>(standard_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span> ))</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co">#then repeating measures for merging</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>med_st &lt;-<span class="st"> </span>med_st[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(med_st)), <span class="dt">each =</span> <span class="dv">8</span>), ]</span>
<span id="cb37-9"><a href="#cb37-9"></a></span>
<span id="cb37-10"><a href="#cb37-10"></a></span>
<span id="cb37-11"><a href="#cb37-11"></a>marbles_new &lt;-<span class="st"> </span>marbles_new[</span>
<span id="cb37-12"><a href="#cb37-12"></a>  <span class="kw">with</span>(marbles_new, <span class="kw">order</span>(marble_name)),</span>
<span id="cb37-13"><a href="#cb37-13"></a>]</span>
<span id="cb37-14"><a href="#cb37-14"></a></span>
<span id="cb37-15"><a href="#cb37-15"></a><span class="kw">glimpse</span>(marbles_new)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 16
## $ date            &lt;chr&gt; &quot;22-Feb-20&quot;, &quot;7-Mar-20&quot;, &quot;21-Mar-20&quot;, &quot;28-Mar-20&quot;, &quot;23…
## $ race            &lt;chr&gt; &quot;S1Q2&quot;, &quot;S1Q4&quot;, &quot;S1Q6&quot;, &quot;S1Q7&quot;, &quot;S1R2&quot;, &quot;S1R4&quot;, &quot;S1R6&quot;…
## $ site            &lt;chr&gt; &quot;O&#39;raceway&quot;, &quot;Hivedrive&quot;, &quot;Short Circuit&quot;, &quot;Razzway&quot;, …
## $ source          &lt;chr&gt; &quot;https://youtu.be/_tE8yYHFLpw?t=332&quot;, &quot;https://youtu.b…
## $ marble_name     &lt;chr&gt; &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;,…
## $ team_name       &lt;chr&gt; &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, …
## $ time_s          &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 327.24, 345.76, 338.16, 33…
## $ pole            &lt;chr&gt; &quot;P9&quot;, &quot;P14&quot;, &quot;P10&quot;, &quot;P15&quot;, NA, NA, NA, NA, &quot;P5&quot;, &quot;P11&quot;…
## $ points          &lt;dbl&gt; NA, NA, NA, NA, 1, 0, 0, 10, NA, NA, NA, NA, 26, 0, 2,…
## $ track_length_m  &lt;dbl&gt; 14.05, 13.20, 11.90, 14.38, 14.05, 13.20, 11.90, 14.38…
## $ number_laps     &lt;dbl&gt; 1, 1, 1, 1, 9, 11, 14, 10, 1, 1, 1, 1, 9, 11, 14, 10, …
## $ avg_time_lap    &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 36.36, 31.43, 24.15, 33.38…
## $ host            &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, …
## $ notes           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, &quot;**Note: Upon the restart,…
## $ average_by_race &lt;dbl&gt; 32.38813, 26.90750, 18.88750, 29.60438, 326.11067, 339…
## $ standard_time   &lt;dbl&gt; 1.0003666, 1.0781381, 1.0223693, 1.0434269, 1.0034630,…</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>marbles_new1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(marbles_new, med_st<span class="op">$</span>med_st_time)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="kw">glimpse</span>(marbles_new1)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 17
## $ date                 &lt;chr&gt; &quot;22-Feb-20&quot;, &quot;7-Mar-20&quot;, &quot;21-Mar-20&quot;, &quot;28-Mar-20&quot;…
## $ race                 &lt;chr&gt; &quot;S1Q2&quot;, &quot;S1Q4&quot;, &quot;S1Q6&quot;, &quot;S1Q7&quot;, &quot;S1R2&quot;, &quot;S1R4&quot;, &quot;…
## $ site                 &lt;chr&gt; &quot;O&#39;raceway&quot;, &quot;Hivedrive&quot;, &quot;Short Circuit&quot;, &quot;Razzw…
## $ source               &lt;chr&gt; &quot;https://youtu.be/_tE8yYHFLpw?t=332&quot;, &quot;https://yo…
## $ marble_name          &lt;chr&gt; &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anar…
## $ team_name            &lt;chr&gt; &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, &quot;Balls of Cha…
## $ time_s               &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 327.24, 345.76, 338.1…
## $ pole                 &lt;chr&gt; &quot;P9&quot;, &quot;P14&quot;, &quot;P10&quot;, &quot;P15&quot;, NA, NA, NA, NA, &quot;P5&quot;, …
## $ points               &lt;dbl&gt; NA, NA, NA, NA, 1, 0, 0, 10, NA, NA, NA, NA, 26, …
## $ track_length_m       &lt;dbl&gt; 14.05, 13.20, 11.90, 14.38, 14.05, 13.20, 11.90, …
## $ number_laps          &lt;dbl&gt; 1, 1, 1, 1, 9, 11, 14, 10, 1, 1, 1, 1, 9, 11, 14,…
## $ avg_time_lap         &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 36.36, 31.43, 24.15, …
## $ host                 &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;…
## $ notes                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, &quot;**Note: Upon the res…
## $ average_by_race      &lt;dbl&gt; 32.38813, 26.90750, 18.88750, 29.60438, 326.11067…
## $ standard_time        &lt;dbl&gt; 1.0003666, 1.0781381, 1.0223693, 1.0434269, 1.003…
## $ `med_st$med_st_time` &lt;dbl&gt; 1.0176650, 1.0176650, 1.0176650, 1.0176650, 1.017…</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co">#creating another median variable by team for plotting in order</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>med_st_team &lt;-<span class="st"> </span>marbles_new  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="st">  </span><span class="kw">group_by</span>(team_name) <span class="op">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">med_st_team =</span> <span class="kw">median</span>(standard_time, <span class="dt">na.rm =</span> <span class="ot">TRUE</span> ))</span>
<span id="cb41-5"><a href="#cb41-5"></a></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="co">#then repeating measures for merging</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>med_st_team &lt;-<span class="st"> </span>med_st_team[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(med_st_team)), <span class="dt">each =</span> <span class="dv">16</span>), ]</span>
<span id="cb41-8"><a href="#cb41-8"></a></span>
<span id="cb41-9"><a href="#cb41-9"></a></span>
<span id="cb41-10"><a href="#cb41-10"></a>marbles_new1 &lt;-<span class="st"> </span>marbles_new1[</span>
<span id="cb41-11"><a href="#cb41-11"></a>  <span class="kw">with</span>(marbles_new1, <span class="kw">order</span>(team_name)),</span>
<span id="cb41-12"><a href="#cb41-12"></a>]</span>
<span id="cb41-13"><a href="#cb41-13"></a></span>
<span id="cb41-14"><a href="#cb41-14"></a></span>
<span id="cb41-15"><a href="#cb41-15"></a>marbles_new1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(marbles_new1, med_st_team<span class="op">$</span>med_st_team)</span>
<span id="cb41-16"><a href="#cb41-16"></a></span>
<span id="cb41-17"><a href="#cb41-17"></a></span>
<span id="cb41-18"><a href="#cb41-18"></a></span>
<span id="cb41-19"><a href="#cb41-19"></a><span class="kw">glimpse</span>(marbles_new1)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 18
## $ date                      &lt;chr&gt; &quot;22-Feb-20&quot;, &quot;7-Mar-20&quot;, &quot;21-Mar-20&quot;, &quot;28-Ma…
## $ race                      &lt;chr&gt; &quot;S1Q2&quot;, &quot;S1Q4&quot;, &quot;S1Q6&quot;, &quot;S1Q7&quot;, &quot;S1R2&quot;, &quot;S1R…
## $ site                      &lt;chr&gt; &quot;O&#39;raceway&quot;, &quot;Hivedrive&quot;, &quot;Short Circuit&quot;, &quot;…
## $ source                    &lt;chr&gt; &quot;https://youtu.be/_tE8yYHFLpw?t=332&quot;, &quot;https…
## $ marble_name               &lt;chr&gt; &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, …
## $ team_name                 &lt;chr&gt; &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, &quot;Balls o…
## $ time_s                    &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 327.24, 345.76, …
## $ pole                      &lt;chr&gt; &quot;P9&quot;, &quot;P14&quot;, &quot;P10&quot;, &quot;P15&quot;, NA, NA, NA, NA, &quot;…
## $ points                    &lt;dbl&gt; NA, NA, NA, NA, 1, 0, 0, 10, NA, NA, NA, NA,…
## $ track_length_m            &lt;dbl&gt; 14.05, 13.20, 11.90, 14.38, 14.05, 13.20, 11…
## $ number_laps               &lt;dbl&gt; 1, 1, 1, 1, 9, 11, 14, 10, 1, 1, 1, 1, 10, 1…
## $ avg_time_lap              &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 36.36, 31.43, 24…
## $ host                      &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;N…
## $ notes                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, &quot;**Note: Upon th…
## $ average_by_race           &lt;dbl&gt; 32.38813, 26.90750, 18.88750, 29.60438, 326.…
## $ standard_time             &lt;dbl&gt; 1.0003666, 1.0781381, 1.0223693, 1.0434269, …
## $ `med_st$med_st_time`      &lt;dbl&gt; 1.0176650, 1.0176650, 1.0176650, 1.0176650, …
## $ `med_st_team$med_st_team` &lt;dbl&gt; 1.006802, 1.006802, 1.006802, 1.006802, 1.00…</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># renaming </span></span></code></pre></div>
</div>
<div id="descriptive-statistics-the-boxplots-below-show-the-standardized-race-times-by-marble-name-and-team-name.-this-includes-both-qualifier-and-official-races.-here-we-see-that-smoggy-prim-and-oringin-tend-to-have-better-race-times-than-the-rest-and-anarchy-sublime-and-mary-have-the-worst.-regarding-teams-hazers-savage-speeders-and-mellow-yellow-are-at-the-top-with-the-lowest-median-race-times." class="section level2">
<h2>Descriptive Statistics: The boxplots below show the standardized race times by marble name and team name. This includes both qualifier and official races. Here we see that Smoggy, Prim, and Oringin tend to have better race times than the rest and Anarchy, Sublime, and Mary have the worst. Regarding teams, Hazers, Savage Speeders, and Mellow Yellow are at the top with the lowest median race times.</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># boxplots of standardized times by marble</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">ggplot</span>(marbles_new1, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(marble_name, <span class="st">`</span><span class="dt">med_st$med_st_time</span><span class="st">`</span> ), <span class="dt">y=</span>standard_time)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title=</span> <span class="st">&quot;Boxplots of Standardized Race Times by Marble Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Marble Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Standardized Race Time&quot;</span>) <span class="op">+</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">#boxplots of standardized times by team</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">ggplot</span>(marbles_new1, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(team_name,  <span class="st">`</span><span class="dt">med_st_team$med_st_team</span><span class="st">`</span>), <span class="dt">y=</span>standard_time)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span> <span class="st">&quot;Boxplots of Standardized Race Times by Team Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Team Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Standardized Race Time&quot;</span>) <span class="op">+</span></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co">#here i make a new dataset sorted by time and race. i will then assign ranks to plot who ranks highest most often</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>marble_rank &lt;-<span class="st"> </span>marbles[<span class="kw">order</span>(marbles<span class="op">$</span>race, marbles<span class="op">$</span>time_s),] </span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a>marble_rank<span class="op">$</span>ranks &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">16</span>, <span class="dv">16</span>)</span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="kw">glimpse</span>(marble_rank)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 15
## $ date           &lt;chr&gt; &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15-Feb-20&quot;, &quot;15…
## $ race           &lt;chr&gt; &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;, &quot;S1Q1&quot;,…
## $ site           &lt;chr&gt; &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;, &quot;Savage Speedway&quot;…
## $ source         &lt;chr&gt; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot;, &quot;https://youtu.be…
## $ marble_name    &lt;chr&gt; &quot;Clementin&quot;, &quot;Starry&quot;, &quot;Momo&quot;, &quot;Yellow&quot;, &quot;Snowy&quot;, &quot;Razz…
## $ team_name      &lt;chr&gt; &quot;O&#39;rangers&quot;, &quot;Team Galactic&quot;, &quot;Team Momo&quot;, &quot;Mellow Yell…
## $ time_s         &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11,…
## $ pole           &lt;chr&gt; &quot;P1&quot;, &quot;P2&quot;, &quot;P3&quot;, &quot;P4&quot;, &quot;P5&quot;, &quot;P6&quot;, &quot;P7&quot;, &quot;P8&quot;, &quot;P9&quot;, &quot;…
## $ points         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ track_length_m &lt;dbl&gt; 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81, 12.81,…
## $ number_laps    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ avg_time_lap   &lt;dbl&gt; 28.11, 28.37, 28.40, 28.70, 28.71, 28.72, 28.96, 29.11,…
## $ host           &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;…
## $ notes          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ ranks          &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, …</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co">#calculating average time by race and saving as a new df</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>team_rank_median &lt;-<span class="st"> </span>marble_rank <span class="op">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="st">  </span><span class="kw">group_by</span>(team_name) <span class="op">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">med_team_rank =</span> <span class="kw">median</span>(ranks, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span>
<span id="cb50-5"><a href="#cb50-5"></a></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="co">#then repeating measures for merging</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>team_rank_median &lt;-<span class="st"> </span>team_rank_median [<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(team_rank_median)), <span class="dt">each =</span> <span class="dv">16</span>), ]</span>
<span id="cb50-8"><a href="#cb50-8"></a></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="co">#merging with original set </span></span>
<span id="cb50-10"><a href="#cb50-10"></a></span>
<span id="cb50-11"><a href="#cb50-11"></a><span class="co">#but first a sort</span></span>
<span id="cb50-12"><a href="#cb50-12"></a>marble_rank &lt;-<span class="st"> </span>marble_rank[<span class="kw">order</span>(marble_rank<span class="op">$</span>team_name),]</span>
<span id="cb50-13"><a href="#cb50-13"></a></span>
<span id="cb50-14"><a href="#cb50-14"></a><span class="co"># merging</span></span>
<span id="cb50-15"><a href="#cb50-15"></a>marble_rank &lt;-<span class="st"> </span><span class="kw">cbind</span>(marble_rank, team_rank_median<span class="op">$</span>med_team_rank)</span>
<span id="cb50-16"><a href="#cb50-16"></a></span>
<span id="cb50-17"><a href="#cb50-17"></a><span class="kw">glimpse</span>(marble_rank)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 16
## $ date                             &lt;chr&gt; &quot;15-Feb-20&quot;, &quot;22-Feb-20&quot;, &quot;29-Feb-20&quot;…
## $ race                             &lt;chr&gt; &quot;S1Q1&quot;, &quot;S1Q2&quot;, &quot;S1Q3&quot;, &quot;S1Q4&quot;, &quot;S1Q5…
## $ site                             &lt;chr&gt; &quot;Savage Speedway&quot;, &quot;O&#39;raceway&quot;, &quot;Momo…
## $ source                           &lt;chr&gt; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot;,…
## $ marble_name                      &lt;chr&gt; &quot;Clutter&quot;, &quot;Anarchy&quot;, &quot;Clutter&quot;, &quot;Ana…
## $ team_name                        &lt;chr&gt; &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, &quot;…
## $ time_s                           &lt;dbl&gt; 31.12, 32.40, 21.05, 29.01, 36.28, 19…
## $ pole                             &lt;chr&gt; &quot;P15&quot;, &quot;P9&quot;, &quot;P2&quot;, &quot;P14&quot;, &quot;P15&quot;, &quot;P10…
## $ points                           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, 0, 1,…
## $ track_length_m                   &lt;dbl&gt; 12.81, 14.05, 12.05, 13.20, 14.55, 11…
## $ number_laps                      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 10, 9, 13, 11…
## $ avg_time_lap                     &lt;dbl&gt; 31.12, 32.40, 21.05, 29.01, 36.28, 19…
## $ host                             &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;…
## $ notes                            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, &quot;Ultimate…
## $ ranks                            &lt;int&gt; 15, 9, 2, 14, 15, 10, 15, 3, 11, 10, …
## $ `team_rank_median$med_team_rank` &lt;dbl&gt; 10.5, 10.5, 10.5, 10.5, 10.5, 10.5, 1…</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co">#boxplots of standardized times by team</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="kw">ggplot</span>(marble_rank, <span class="kw">aes</span>(<span class="kw">reorder</span>(<span class="dt">x=</span> team_name, <span class="st">`</span><span class="dt">team_rank_median$med_team_rank</span><span class="st">`</span>), <span class="dt">y=</span>ranks)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span> <span class="st">&quot;Boxplots of Ranks by Team Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Team Name&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Ranks&quot;</span>) <span class="op">+</span></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="modeling" class="section level2">
<h2>Modeling</h2>
<p>Now that we’ve explored the data, we see that certain teams might be more likely to rank better (have faster times), and certain marbles might be more likely to rank better. Let’s do some predictive modeling to see if team predicts race time. Due to races being different lengths, I’ve decided to calculate meters per second for each observation and use that as our outcome. I know I used this standardized outcome before for plotting, but I don’t think that makes as much sense for modeling. I want to model speed! Our main predictor is going to be team, but we will also see if host(if the marble’s team hosted the race or not) has an impact on speed. I think we should also control for Race because each race/track set up is going to be different and that needs to be accounted for in the modeling. On that note, I’m also going to throw in site.</p>
</div>
<div id="setting-up-recipe-random-seed-data-split-and-cross-validation" class="section level1">
<h1>Setting up: Recipe, Random Seed, Data Split, and Cross Validation</h1>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co">#creating factors and our outcome variable</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>marbles_new1 &lt;-<span class="st"> </span>marbles_new1 <span class="op">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">team_factor =</span> <span class="kw">as.factor</span>(team_name),</span>
<span id="cb53-4"><a href="#cb53-4"></a>                  <span class="dt">site_factor =</span> <span class="kw">as.factor</span>(site),</span>
<span id="cb53-5"><a href="#cb53-5"></a>                  <span class="dt">host_factor =</span> <span class="kw">as.factor</span>(host),</span>
<span id="cb53-6"><a href="#cb53-6"></a>                  <span class="dt">meters_ps =</span> track_length_m <span class="op">/</span><span class="st"> </span>time_s,</span>
<span id="cb53-7"><a href="#cb53-7"></a>                  <span class="dt">race_factor=</span> <span class="kw">as.factor</span>(race))</span>
<span id="cb53-8"><a href="#cb53-8"></a></span>
<span id="cb53-9"><a href="#cb53-9"></a><span class="co">#checking</span></span>
<span id="cb53-10"><a href="#cb53-10"></a><span class="kw">glimpse</span>(marbles_new1)</span></code></pre></div>
<pre><code>## Rows: 256
## Columns: 23
## $ date                      &lt;chr&gt; &quot;22-Feb-20&quot;, &quot;7-Mar-20&quot;, &quot;21-Mar-20&quot;, &quot;28-Ma…
## $ race                      &lt;chr&gt; &quot;S1Q2&quot;, &quot;S1Q4&quot;, &quot;S1Q6&quot;, &quot;S1Q7&quot;, &quot;S1R2&quot;, &quot;S1R…
## $ site                      &lt;chr&gt; &quot;O&#39;raceway&quot;, &quot;Hivedrive&quot;, &quot;Short Circuit&quot;, &quot;…
## $ source                    &lt;chr&gt; &quot;https://youtu.be/_tE8yYHFLpw?t=332&quot;, &quot;https…
## $ marble_name               &lt;chr&gt; &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, &quot;Anarchy&quot;, …
## $ team_name                 &lt;chr&gt; &quot;Balls of Chaos&quot;, &quot;Balls of Chaos&quot;, &quot;Balls o…
## $ time_s                    &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 327.24, 345.76, …
## $ pole                      &lt;chr&gt; &quot;P9&quot;, &quot;P14&quot;, &quot;P10&quot;, &quot;P15&quot;, NA, NA, NA, NA, &quot;…
## $ points                    &lt;dbl&gt; NA, NA, NA, NA, 1, 0, 0, 10, NA, NA, NA, NA,…
## $ track_length_m            &lt;dbl&gt; 14.05, 13.20, 11.90, 14.38, 14.05, 13.20, 11…
## $ number_laps               &lt;dbl&gt; 1, 1, 1, 1, 9, 11, 14, 10, 1, 1, 1, 1, 10, 1…
## $ avg_time_lap              &lt;dbl&gt; 32.40, 29.01, 19.31, 30.89, 36.36, 31.43, 24…
## $ host                      &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;N…
## $ notes                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, &quot;**Note: Upon th…
## $ average_by_race           &lt;dbl&gt; 32.38813, 26.90750, 18.88750, 29.60438, 326.…
## $ standard_time             &lt;dbl&gt; 1.0003666, 1.0781381, 1.0223693, 1.0434269, …
## $ `med_st$med_st_time`      &lt;dbl&gt; 1.0176650, 1.0176650, 1.0176650, 1.0176650, …
## $ `med_st_team$med_st_team` &lt;dbl&gt; 1.006802, 1.006802, 1.006802, 1.006802, 1.00…
## $ team_factor               &lt;fct&gt; Balls of Chaos, Balls of Chaos, Balls of Cha…
## $ site_factor               &lt;fct&gt; O&#39;raceway, Hivedrive, Short Circuit, Razzway…
## $ host_factor               &lt;fct&gt; No, No, No, No, No, No, No, No, No, No, No, …
## $ meters_ps                 &lt;dbl&gt; 0.43364198, 0.45501551, 0.61626100, 0.465522…
## $ race_factor               &lt;fct&gt; S1Q2, S1Q4, S1Q6, S1Q7, S1R2, S1R4, S1R6, S1…</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co">#calculating average time by race and saving as a new df</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>av_race_times &lt;-<span class="st"> </span>marbles_new1 <span class="op">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="st">  </span><span class="kw">group_by</span>(race) <span class="op">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">mean_race_time =</span> <span class="kw">mean</span>(meters_ps, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span>
<span id="cb55-5"><a href="#cb55-5"></a></span>
<span id="cb55-6"><a href="#cb55-6"></a><span class="kw">lm</span>(<span class="dt">data=</span> marbles_new1, meters_ps <span class="op">~</span><span class="st"> </span>race )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = meters_ps ~ race, data = marbles_new1)
## 
## Coefficients:
## (Intercept)     raceS1Q2     raceS1Q3     raceS1Q4     raceS1Q5     raceS1Q6  
##   0.4355634   -0.0009944    0.1122998    0.0569389   -0.0235973    0.1953677  
##    raceS1Q7     raceS1Q8     raceS1R1     raceS1R2     raceS1R3     raceS1R4  
##   0.0504833    0.0671326   -0.3969596   -0.3924722   -0.4006998   -0.3966234  
##    raceS1R5     raceS1R6     raceS1R7     raceS1R8  
##  -0.3958961   -0.3998262   -0.3928318   -0.4088525</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">#subsetting what we need</span></span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a>newdata &lt;-<span class="st"> </span>marbles_new1[<span class="kw">c</span>(<span class="dv">19</span><span class="op">:</span><span class="dv">23</span>)]</span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a>newdata &lt;-<span class="st"> </span><span class="kw">na.omit</span>(newdata)</span>
<span id="cb57-6"><a href="#cb57-6"></a></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb57-8"><a href="#cb57-8"></a></span>
<span id="cb57-9"><a href="#cb57-9"></a>data_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(newdata, <span class="dt">prop =</span> <span class="fl">.7</span>, <span class="dt">strata =</span> <span class="st">&quot;meters_ps&quot;</span>)</span>
<span id="cb57-10"><a href="#cb57-10"></a></span>
<span id="cb57-11"><a href="#cb57-11"></a>train_data &lt;-<span class="st"> </span><span class="kw">training</span>(data_split)</span>
<span id="cb57-12"><a href="#cb57-12"></a>test_data  &lt;-<span class="st"> </span><span class="kw">testing</span>(data_split)</span>
<span id="cb57-13"><a href="#cb57-13"></a></span>
<span id="cb57-14"><a href="#cb57-14"></a>folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_data, <span class="dt">v =</span> <span class="dv">5</span>, <span class="dt">r=</span><span class="dv">5</span>, <span class="dt">strata=</span> <span class="st">&quot;meters_ps&quot;</span>)</span>
<span id="cb57-15"><a href="#cb57-15"></a>folds</span></code></pre></div>
<pre><code>## #  5-fold cross-validation repeated 5 times using stratification 
## # A tibble: 25 × 3
##    splits           id      id2  
##    &lt;list&gt;           &lt;chr&gt;   &lt;chr&gt;
##  1 &lt;split [140/36]&gt; Repeat1 Fold1
##  2 &lt;split [140/36]&gt; Repeat1 Fold2
##  3 &lt;split [140/36]&gt; Repeat1 Fold3
##  4 &lt;split [140/36]&gt; Repeat1 Fold4
##  5 &lt;split [144/32]&gt; Repeat1 Fold5
##  6 &lt;split [140/36]&gt; Repeat2 Fold1
##  7 &lt;split [140/36]&gt; Repeat2 Fold2
##  8 &lt;split [140/36]&gt; Repeat2 Fold3
##  9 &lt;split [140/36]&gt; Repeat2 Fold4
## 10 &lt;split [144/32]&gt; Repeat2 Fold5
## # … with 15 more rows</code></pre>
<p>Creating a Recipe/Workflow and running the multivariate model</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># THEN WE CALCULATE THE RMSE FOR THE NULL MODEL (TRAINING DATA)</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>RMSE_null_train &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">sum</span>( (train_data<span class="op">$</span>meters_ps <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(train_data<span class="op">$</span>meters_ps))<span class="op">^</span><span class="dv">2</span> )<span class="op">/</span><span class="kw">nrow</span>(train_data))</span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="kw">print</span>(RMSE_null_train)</span></code></pre></div>
<pre><code>## [1] 0.2316689</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co">#Recipe() has two arguments: a formula and the data</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>time_s_recipe &lt;-<span class="st"> </span><span class="kw">recipe</span>(meters_ps<span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_data) <span class="op">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal_predictors</span>()) <span class="co">#adding step_dummy</span></span>
<span id="cb61-4"><a href="#cb61-4"></a></span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a></span>
<span id="cb61-7"><a href="#cb61-7"></a></span>
<span id="cb61-8"><a href="#cb61-8"></a><span class="co">#Build a model specification using the parsnip package</span></span>
<span id="cb61-9"><a href="#cb61-9"></a>lm_mod &lt;-<span class="st"> </span><span class="kw">linear_reg</span>() <span class="op">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;lm&quot;</span>) </span>
<span id="cb61-11"><a href="#cb61-11"></a></span>
<span id="cb61-12"><a href="#cb61-12"></a><span class="co">#Model workflow pairs a model and recipe together</span></span>
<span id="cb61-13"><a href="#cb61-13"></a>time_cont_workflow &lt;-<span class="st"> </span></span>
<span id="cb61-14"><a href="#cb61-14"></a><span class="st">  </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15"></a><span class="st">  </span><span class="kw">add_model</span>(lm_mod) <span class="op">%&gt;%</span></span>
<span id="cb61-16"><a href="#cb61-16"></a><span class="st">  </span><span class="kw">add_recipe</span>(time_s_recipe)</span>
<span id="cb61-17"><a href="#cb61-17"></a></span>
<span id="cb61-18"><a href="#cb61-18"></a></span>
<span id="cb61-19"><a href="#cb61-19"></a><span class="co"># Fitting the model</span></span>
<span id="cb61-20"><a href="#cb61-20"></a>time_fit &lt;-<span class="st"> </span></span>
<span id="cb61-21"><a href="#cb61-21"></a><span class="st">  </span>time_cont_workflow <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-22"><a href="#cb61-22"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb61-23"><a href="#cb61-23"></a></span>
<span id="cb61-24"><a href="#cb61-24"></a><span class="co"># Extracting Model/Recipes with Parsnip</span></span>
<span id="cb61-25"><a href="#cb61-25"></a>time_fit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-26"><a href="#cb61-26"></a><span class="st">  </span><span class="kw">extract_fit_parsnip</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-27"><a href="#cb61-27"></a><span class="st">  </span><span class="kw">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 39 × 5
##    term                          estimate std.error statistic       p.value
##    &lt;chr&gt;                            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 (Intercept)                   0.0356     0.00570    6.25   0.00000000448
##  2 team_factor_Green.Ducks       0.00369    0.00590    0.626  0.532        
##  3 team_factor_Hazers            0.0122     0.00630    1.93   0.0550       
##  4 team_factor_Hornets          -0.00112    0.00599   -0.188  0.851        
##  5 team_factor_Limers            0.000719   0.00652    0.110  0.912        
##  6 team_factor_Mellow.Yellow     0.0114     0.00608    1.88   0.0625       
##  7 team_factor_Midnight.Wisps    0.00357    0.00593    0.602  0.548        
##  8 team_factor_O.rangers         0.00436    0.00612    0.713  0.477        
##  9 team_factor_Raspberry.Racers -0.000146   0.00615   -0.0238 0.981        
## 10 team_factor_Rojo.Rollers      0.000600   0.00656    0.0913 0.927        
## # … with 29 more rows</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Obtaining Predictions</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="kw">predict</span>(time_fit , train_data)</span></code></pre></div>
<pre><code>## Warning in predict.lm(object = object$fit, newdata = new_data, type =
## &quot;response&quot;): prediction from a rank-deficient fit may be misleading</code></pre>
<pre><code>## # A tibble: 176 × 1
##     .pred
##     &lt;dbl&gt;
##  1 0.0319
##  2 0.0358
##  3 0.0231
##  4 0.0393
##  5 0.0356
##  6 0.0395
##  7 0.0341
##  8 0.0268
##  9 0.0353
## 10 0.0441
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>time_aug &lt;-<span class="st"> </span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="st">  </span><span class="kw">augment</span>(time_fit, train_data)</span></code></pre></div>
<pre><code>## Warning in predict.lm(object = object$fit, newdata = new_data, type =
## &quot;response&quot;): prediction from a rank-deficient fit may be misleading</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>time_aug <span class="op">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="st">  </span><span class="kw">select</span>(meters_ps)</span></code></pre></div>
<pre><code>## # A tibble: 176 × 1
##    meters_ps
##        &lt;dbl&gt;
##  1    0.0352
##  2    0.0382
##  3    0.0269
##  4    0.0384
##  5    0.0357
##  6    0.0387
##  7    0.0352
##  8    0.0270
##  9    0.0268
## 10    0.0357
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Calculating Root RMSE </span></span>
<span id="cb70-2"><a href="#cb70-2"></a>rmse_train &lt;-<span class="st"> </span>time_aug <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="st">  </span><span class="kw">rmse</span>(<span class="dt">truth =</span> meters_ps, .pred)</span></code></pre></div>
<p>Below we see that the multivarite model reduces the RMSE compared with the null.The multivariate model had and RMSE of 0.01265661 while the null had 0.2316689.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co">#COMPARING TO NULL MODEL </span></span>
<span id="cb71-2"><a href="#cb71-2"></a></span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="co">#Looks like our model with all predictors does better than the null at reducing</span></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co">#RMSE</span></span>
<span id="cb71-5"><a href="#cb71-5"></a></span>
<span id="cb71-6"><a href="#cb71-6"></a>rmse_train</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard      0.0127</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">print</span>(RMSE_null_train)</span></code></pre></div>
<pre><code>## [1] 0.2316689</code></pre>
<div id="now-lets-try-a-lasso-model" class="section level2">
<h2>Now let’s try a LASSO Model</h2>
<p>Below I set up a model, workflow, grid and tune the model.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">#LASSO</span></span>
<span id="cb75-2"><a href="#cb75-2"></a></span>
<span id="cb75-3"><a href="#cb75-3"></a></span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="co"># model</span></span>
<span id="cb75-6"><a href="#cb75-6"></a>lasso_model &lt;-<span class="st"> </span><span class="kw">linear_reg</span>() <span class="op">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>) <span class="op">%&gt;%</span><span class="st">           </span></span>
<span id="cb75-8"><a href="#cb75-8"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb75-9"><a href="#cb75-9"></a><span class="st">  </span><span class="kw">set_args</span>(<span class="dt">penalty =</span> <span class="kw">tune</span>(), <span class="dt">mixture =</span> <span class="dv">1</span>) <span class="co">#mixture = 1 means we use the LASSO model</span></span>
<span id="cb75-10"><a href="#cb75-10"></a></span>
<span id="cb75-11"><a href="#cb75-11"></a><span class="co"># workflow</span></span>
<span id="cb75-12"><a href="#cb75-12"></a>lasso_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb75-13"><a href="#cb75-13"></a><span class="st">  </span><span class="kw">add_model</span>(lasso_model) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-14"><a href="#cb75-14"></a><span class="st">  </span><span class="kw">add_recipe</span>(time_s_recipe)</span>
<span id="cb75-15"><a href="#cb75-15"></a></span>
<span id="cb75-16"><a href="#cb75-16"></a></span>
<span id="cb75-17"><a href="#cb75-17"></a><span class="co">### LASSO tuning</span></span>
<span id="cb75-18"><a href="#cb75-18"></a></span>
<span id="cb75-19"><a href="#cb75-19"></a><span class="co">#tuning grid</span></span>
<span id="cb75-20"><a href="#cb75-20"></a>lasso_reg_grid &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">penalty =</span> <span class="dv">10</span><span class="op">^</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb75-21"><a href="#cb75-21"></a><span class="co">#tune model</span></span>
<span id="cb75-22"><a href="#cb75-22"></a>lasso_tune_res &lt;-<span class="st"> </span>lasso_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-23"><a href="#cb75-23"></a><span class="st">  </span><span class="kw">tune_grid</span>(<span class="dt">resamples =</span> folds,</span>
<span id="cb75-24"><a href="#cb75-24"></a>            <span class="dt">grid =</span> lasso_reg_grid,</span>
<span id="cb75-25"><a href="#cb75-25"></a>            <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>),</span>
<span id="cb75-26"><a href="#cb75-26"></a>            <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse)</span>
<span id="cb75-27"><a href="#cb75-27"></a>  )</span></code></pre></div>
<p>Now we take a look at the model evaluation. As one sees, the larger the regularization penalty, the fewer predictor variables that remain in the model. Once a coefficient is at 0, the corresponding variable is not in the model anymore).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co">### LASSO evaluation</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co">#see a plot of performance for different tuning parameters</span></span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="co"># This plots shows us that model performance is generally better</span></span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="co"># at the smaller penalty values. This suggests that the majority</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="co"># of the predictors are important to the model.</span></span>
<span id="cb76-6"><a href="#cb76-6"></a>lasso_plot &lt;-<span class="st"> </span>lasso_tune_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">autoplot</span>()</span>
<span id="cb76-7"><a href="#cb76-7"></a></span>
<span id="cb76-8"><a href="#cb76-8"></a>lasso_plot</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># get the tuned model that performs best </span></span>
<span id="cb77-2"><a href="#cb77-2"></a>best_lasso &lt;-<span class="st"> </span>lasso_tune_res <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">select_best</span>(<span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="co"># finalize workflow with best model</span></span>
<span id="cb77-4"><a href="#cb77-4"></a>best_lasso_wf &lt;-<span class="st"> </span>lasso_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">finalize_workflow</span>(best_lasso)</span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="co"># fitting best performing model</span></span>
<span id="cb77-6"><a href="#cb77-6"></a>best_lasso_fit &lt;-<span class="st"> </span>best_lasso_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb77-7"><a href="#cb77-7"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb77-8"><a href="#cb77-8"></a>lasso_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(best_lasso_fit, train_data)</span>
<span id="cb77-9"><a href="#cb77-9"></a></span>
<span id="cb77-10"><a href="#cb77-10"></a></span>
<span id="cb77-11"><a href="#cb77-11"></a></span>
<span id="cb77-12"><a href="#cb77-12"></a><span class="co">#Plotting LASSO variables as function of tuning parameter</span></span>
<span id="cb77-13"><a href="#cb77-13"></a></span>
<span id="cb77-14"><a href="#cb77-14"></a>x &lt;-<span class="st"> </span>best_lasso_fit<span class="op">$</span>fit<span class="op">$</span>fit<span class="op">$</span>fit</span>
<span id="cb77-15"><a href="#cb77-15"></a></span>
<span id="cb77-16"><a href="#cb77-16"></a>LASSO_tune_plot &lt;-<span class="st"> </span><span class="kw">plot</span>(x, <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>LASSO_tune_plot</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>The Lasso vars shows the variables that are part of the best-fit LASSO model, i.e. those that have a non-zero coefficient The team_factor variable category is being compared to Limers, who had the second lowest ranks. Here we see that the Hazers, Hornets, Mellow Yellow, and Rasberry Racers came out in the LASSO model. Host factor stayed as well and it actually looks like those who host, tend to have a lower speed time. The diagnostic plots don’t look great. Maybe that’s because we don’t have a lot of data? Maybe it’s because we used data from both the qualifers and the real races.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># It appears that all predictors stayed in the model</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>LASSO_vars &lt;-<span class="st"> </span><span class="kw">tidy</span>(<span class="kw">extract_fit_parsnip</span>(best_lasso_fit)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(estimate <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb80-3"><a href="#cb80-3"></a>LASSO_vars</span></code></pre></div>
<pre><code>## # A tibble: 22 × 3
##    term                          estimate penalty
##    &lt;chr&gt;                            &lt;dbl&gt;   &lt;dbl&gt;
##  1 (Intercept)                   0.412      0.001
##  2 team_factor_Hazers            0.00655    0.001
##  3 team_factor_Hornets          -0.00161    0.001
##  4 team_factor_Mellow.Yellow     0.00490    0.001
##  5 team_factor_Raspberry.Racers -0.000630   0.001
##  6 team_factor_Savage.Speeders   0.000632   0.001
##  7 site_factor_Savage.Speedway   0.0160     0.001
##  8 host_factor_Yes              -0.00159    0.001
##  9 race_factor_S1Q2              0.0161     0.001
## 10 race_factor_S1Q3              0.129      0.001
## # … with 12 more rows</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co">#Plotting observed/predicted and residuals.</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="co">#predicted versus observed</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>LASSO_predicted_vs_observed &lt;-<span class="st"> </span><span class="kw">plot</span>(lasso_pred<span class="op">$</span>.pred,train_data<span class="op">$</span>meters_ps)</span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#45 degree line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co">#residuals</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>LASSO_residuals &lt;-<span class="st"> </span><span class="kw">plot</span>(lasso_pred<span class="op">$</span>.pred<span class="op">-</span>train_data<span class="op">$</span>meters_ps)</span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#straight line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># The diagnostic plots show that this model </span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="co"># isn&#39;t much better either. We want the points</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="co"># to be along the red lines in each plot. They are not.</span></span></code></pre></div>
<p>Finally, we see that the LASSO brought the RMSE down to 0.0156, which is pretty good compared with the null, but the diagnostic plots still looked pretty bad so it might not be the best model.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co">#Looking at model performance. </span></span>
<span id="cb85-2"><a href="#cb85-2"></a></span>
<span id="cb85-3"><a href="#cb85-3"></a>lasso_perfomance &lt;-<span class="st"> </span>lasso_tune_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="dt">n =</span> <span class="dv">1</span>)</span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="kw">print</span>(lasso_perfomance)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 7
##   penalty .metric .estimator   mean     n  std_err .config              
##     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;                
## 1   0.001 rmse    standard   0.0156    25 0.000620 Preprocessor1_Model01</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>RMSE_null_train</span></code></pre></div>
<pre><code>## [1] 0.2316689</code></pre>
<p>#Fitting a Tree</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># TREE </span></span>
<span id="cb89-2"><a href="#cb89-2"></a></span>
<span id="cb89-3"><a href="#cb89-3"></a><span class="co"># model specification</span></span>
<span id="cb89-4"><a href="#cb89-4"></a>tune_spec &lt;-<span class="st"> </span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="st">  </span><span class="kw">decision_tree</span>(</span>
<span id="cb89-6"><a href="#cb89-6"></a>    <span class="dt">cost_complexity =</span> <span class="kw">tune</span>(),</span>
<span id="cb89-7"><a href="#cb89-7"></a>    <span class="dt">tree_depth =</span> <span class="kw">tune</span>()</span>
<span id="cb89-8"><a href="#cb89-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-10"><a href="#cb89-10"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)    <span class="co"># setting it to regression instead of classification</span></span>
<span id="cb89-11"><a href="#cb89-11"></a></span>
<span id="cb89-12"><a href="#cb89-12"></a>tune_spec</span></code></pre></div>
<pre><code>## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = tune()
##   tree_depth = tune()
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># tuning grid specification</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>tree_grid &lt;-<span class="st"> </span><span class="kw">grid_regular</span>(<span class="kw">cost_complexity</span>(),</span>
<span id="cb91-3"><a href="#cb91-3"></a>                          <span class="kw">tree_depth</span>(),</span>
<span id="cb91-4"><a href="#cb91-4"></a>                          <span class="dt">levels =</span> <span class="dv">5</span>)</span>
<span id="cb91-5"><a href="#cb91-5"></a></span>
<span id="cb91-6"><a href="#cb91-6"></a></span>
<span id="cb91-7"><a href="#cb91-7"></a>tree_grid <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-8"><a href="#cb91-8"></a><span class="st">  </span><span class="kw">count</span>(tree_depth)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   tree_depth     n
##        &lt;int&gt; &lt;int&gt;
## 1          1     5
## 2          4     5
## 3          8     5
## 4         11     5
## 5         15     5</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># Tune a workflow() that bundles together a model</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="co"># specification and a recipe or model preprocessor.</span></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="co"># Here we use a workflow() with a straightforward formula; </span></span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="co"># if this model required more involved data preprocessing, </span></span>
<span id="cb93-5"><a href="#cb93-5"></a><span class="co"># we could use add_recipe() instead of add_formula().</span></span>
<span id="cb93-6"><a href="#cb93-6"></a></span>
<span id="cb93-7"><a href="#cb93-7"></a></span>
<span id="cb93-8"><a href="#cb93-8"></a>tree_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb93-9"><a href="#cb93-9"></a><span class="st">  </span><span class="kw">add_model</span>(tune_spec) <span class="op">%&gt;%</span></span>
<span id="cb93-10"><a href="#cb93-10"></a><span class="st">  </span><span class="kw">add_recipe</span>(time_s_recipe) <span class="co"># using predefined recipe</span></span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># tuning using cross-validation and the tune_grid() function</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>tree_res &lt;-<span class="st"> </span></span>
<span id="cb94-3"><a href="#cb94-3"></a><span class="st">  </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="st">  </span><span class="kw">tune_grid</span>(<span class="dt">resamples =</span> folds, <span class="dt">grid =</span> tree_grid)</span></code></pre></div>
<pre><code>## ! Fold4, Repeat1: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Fold1, Repeat3: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Fold4, Repeat4: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Fold5, Repeat4: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<pre><code>## ! Fold1, Repeat5: internal: A correlation computation is required, but `estimate` is const...</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>tree_res <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 50 × 8
##    cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
##              &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
##  1    0.0000000001          1 rmse    standard   0.219    25 0.00208 Preprocess…
##  2    0.0000000001          1 rsq     standard   0.132    20 0.0144  Preprocess…
##  3    0.0000000178          1 rmse    standard   0.219    25 0.00208 Preprocess…
##  4    0.0000000178          1 rsq     standard   0.132    20 0.0144  Preprocess…
##  5    0.00000316            1 rmse    standard   0.219    25 0.00208 Preprocess…
##  6    0.00000316            1 rsq     standard   0.132    20 0.0144  Preprocess…
##  7    0.000562              1 rmse    standard   0.219    25 0.00208 Preprocess…
##  8    0.000562              1 rsq     standard   0.132    20 0.0144  Preprocess…
##  9    0.1                   1 rmse    standard   0.219    25 0.00208 Preprocess…
## 10    0.1                   1 rsq     standard   0.132    20 0.0144  Preprocess…
## # … with 40 more rows</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># Once you have done the tuning, you can take a look at some diagnostics</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="co">#by sending your object returned from the tune_grid() function to autoplot(). </span></span>
<span id="cb102-3"><a href="#cb102-3"></a><span class="co">#For instance if you tuned the tree and saved the result as tree_tune_res,</span></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="co">#you can run tree_tune_res %&gt;% autoplot(). Depending on the model, the plot</span></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co">#will be different, but in general it shows you what happened during the tuning process.</span></span>
<span id="cb102-6"><a href="#cb102-6"></a></span>
<span id="cb102-7"><a href="#cb102-7"></a><span class="co">#plotting metrics</span></span>
<span id="cb102-8"><a href="#cb102-8"></a>tree_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Next, you want to get the model that the tuning process has determined </span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="co"># is the best. You can get the best-fit model with select_best() </span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co"># and finalize_workflow() and then do one more fit to the training data with </span></span>
<span id="cb103-4"><a href="#cb103-4"></a><span class="co"># this final workflow using the fit() function. Follow the examples in the tutorial.</span></span>
<span id="cb103-5"><a href="#cb103-5"></a></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co"># selecting best</span></span>
<span id="cb103-7"><a href="#cb103-7"></a>best_tree &lt;-<span class="st"> </span>tree_res <span class="op">%&gt;%</span></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="st">  </span><span class="kw">select_best</span>(tree_res, <span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb103-9"><a href="#cb103-9"></a></span>
<span id="cb103-10"><a href="#cb103-10"></a>best_tree</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   cost_complexity tree_depth .config              
##             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;                
## 1    0.0000000001         15 Preprocessor1_Model21</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="co"># finalizing model</span></span>
<span id="cb105-2"><a href="#cb105-2"></a>final_wf &lt;-<span class="st"> </span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="st">  </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_tree)</span>
<span id="cb105-5"><a href="#cb105-5"></a></span>
<span id="cb105-6"><a href="#cb105-6"></a>final_wf</span></code></pre></div>
<pre><code>## ══ Workflow ════════════════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: decision_tree()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 1 Recipe Step
## 
## • step_dummy()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = 1e-10
##   tree_depth = 15
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># one more fit to the training data with </span></span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="co"># this final workflow using the fit() function</span></span>
<span id="cb107-3"><a href="#cb107-3"></a></span>
<span id="cb107-4"><a href="#cb107-4"></a>final_fit &lt;-<span class="st"> </span></span>
<span id="cb107-5"><a href="#cb107-5"></a><span class="st">  </span>final_wf <span class="op">%&gt;%</span></span>
<span id="cb107-6"><a href="#cb107-6"></a><span class="st">  </span><span class="kw">last_fit</span>(data_split) </span>
<span id="cb107-7"><a href="#cb107-7"></a></span>
<span id="cb107-8"><a href="#cb107-8"></a></span>
<span id="cb107-9"><a href="#cb107-9"></a><span class="co"># RMSE= 1.23, not much different from the null</span></span>
<span id="cb107-10"><a href="#cb107-10"></a>final_fit <span class="op">%&gt;%</span></span>
<span id="cb107-11"><a href="#cb107-11"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard      0.0964 Preprocessor1_Model1
## 2 rsq     standard      0.839  Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="co">#Collecting Predictions</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>tree_pred &lt;-<span class="st"> </span>final_fit <span class="op">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3"></a><span class="st">  </span><span class="kw">collect_predictions</span>() </span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># Make two plots, one that shows model predictions from the tuned model </span></span>
<span id="cb110-2"><a href="#cb110-2"></a><span class="co"># versus actual outcomes</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>  </span>
<span id="cb110-4"><a href="#cb110-4"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>tree_pred, <span class="kw">aes</span>(<span class="dt">x=</span>.pred, <span class="dt">y=</span>meters_ps)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">title=</span> <span class="st">&quot;Plot of Model Predictions from Tuned Model vs Actual Outcomes&quot;</span>, </span>
<span id="cb110-5"><a href="#cb110-5"></a>       <span class="dt">x=</span> <span class="st">&quot;Model Predictions&quot;</span>, <span class="dt">y=</span> <span class="st">&quot;Actual Outcomes&quot;</span>) </span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="co">#calculating residuals</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>tree_pred<span class="op">$</span>resid &lt;-<span class="st"> </span>tree_pred<span class="op">$</span>meters_ps <span class="op">-</span><span class="st"> </span>tree_pred<span class="op">$</span>.pred </span>
<span id="cb111-3"><a href="#cb111-3"></a></span>
<span id="cb111-4"><a href="#cb111-4"></a><span class="co"># one that plots residuals.</span></span>
<span id="cb111-5"><a href="#cb111-5"></a><span class="co"># plotting residuals </span></span>
<span id="cb111-6"><a href="#cb111-6"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>tree_pred, <span class="kw">aes</span>(<span class="dt">x=</span>.pred , <span class="dt">y=</span>resid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb111-7"><a href="#cb111-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span> <span class="st">&quot;Plot of Model Predictions from Tuned Model vs Actual Outcomes&quot;</span>, </span>
<span id="cb111-8"><a href="#cb111-8"></a>       <span class="dt">x=</span> <span class="st">&quot;Model Predictions&quot;</span>, <span class="dt">y=</span> <span class="st">&quot;Residuals&quot;</span>) </span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># Look at/print the model performance and compare it with the null model</span></span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="co"># (still only on training data). Here, we want the performance of the tuned, </span></span>
<span id="cb112-3"><a href="#cb112-3"></a><span class="co"># best-fitting model on the CV dataset (we are not yet touching the test data). </span></span>
<span id="cb112-4"><a href="#cb112-4"></a><span class="co"># You can get that for instance with the show_best() function, which gives you</span></span>
<span id="cb112-5"><a href="#cb112-5"></a><span class="co"># the mean cross-validated performance for the best models. It also shows the</span></span>
<span id="cb112-6"><a href="#cb112-6"></a><span class="co"># standard deviation for the performance. Compare that model performance with the null model</span></span></code></pre></div>
<p>###Comparing RMSE to Null</p>
<p>The tree model reduced the RMSE to 0.0963, but the diagnostic plots also look off here.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="kw">show_best</span>(final_fit, <span class="dt">metric=</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 7
##   .workflow  .metric .estimator   mean     n std_err .config             
##   &lt;list&gt;     &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1 &lt;workflow&gt; rmse    standard   0.0964     1      NA Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>RMSE_null_train</span></code></pre></div>
<pre><code>## [1] 0.2316689</code></pre>
<div id="here-we-estimate-variable-importance-based-on-the-models-structure.-this-is-expected-but-we-see-that-the-race-is-the-most-important-variable-next-to-site.-our-maing-predictor-did-not-make-it." class="section level3">
<h3>Here we estimate variable importance based on the model’s structure. This is expected, but we see that the race is the most important variable, next to site. Our maing predictor did not make it.</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="kw">library</span>(vip)</span>
<span id="cb117-2"><a href="#cb117-2"></a></span>
<span id="cb117-3"><a href="#cb117-3"></a>final_fit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-4"><a href="#cb117-4"></a><span class="st">  </span><span class="kw">extract_fit_parsnip</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-5"><a href="#cb117-5"></a><span class="st">  </span><span class="kw">vip</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
</div>
<div id="random-forest-model" class="section level2">
<h2>Random forest model</h2>
<p>Repeating the steps above, now for a random forest.</p>
<div id="random-forest-setup" class="section level3">
<h3>Random forest setup</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>rf_model &lt;-<span class="st"> </span><span class="kw">rand_forest</span>() <span class="op">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="st">  </span><span class="kw">set_args</span>(<span class="dt">mtry =</span> <span class="kw">tune</span>(),     </span>
<span id="cb118-3"><a href="#cb118-3"></a>    <span class="dt">trees =</span> <span class="kw">tune</span>(),</span>
<span id="cb118-4"><a href="#cb118-4"></a>    <span class="dt">min_n =</span> <span class="kw">tune</span>()</span>
<span id="cb118-5"><a href="#cb118-5"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb118-6"><a href="#cb118-6"></a><span class="st">  </span><span class="co"># select the engine/package that underlies the model</span></span>
<span id="cb118-7"><a href="#cb118-7"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>,</span>
<span id="cb118-8"><a href="#cb118-8"></a>             <span class="dt">num.threads =</span> <span class="dv">18</span>, <span class="co">#for some reason for RF, we need to set this in the engine too</span></span>
<span id="cb118-9"><a href="#cb118-9"></a>             <span class="dt">importance =</span> <span class="st">&quot;permutation&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb118-10"><a href="#cb118-10"></a><span class="st">  </span><span class="co"># choose either the continuous regression or binary classification mode</span></span>
<span id="cb118-11"><a href="#cb118-11"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)           </span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co">#workflow</span></span>
<span id="cb119-2"><a href="#cb119-2"></a>rf_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="st">  </span><span class="kw">add_model</span>(rf_model) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb119-4"><a href="#cb119-4"></a><span class="st">  </span><span class="kw">add_recipe</span>(time_s_recipe)</span></code></pre></div>
</div>
<div id="random-forest-tuning" class="section level3">
<h3>Random forest tuning</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co">#parallel computing</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="co">#tuning grid</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>rf_grid  &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">mtry =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="dt">min_n =</span> <span class="kw">c</span>(<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>), <span class="dt">trees =</span> <span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">1000</span>)  )</span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="co"># tune the model, optimizing RMSE</span></span>
<span id="cb120-5"><a href="#cb120-5"></a>rf_tune_res &lt;-<span class="st"> </span>rf_wf <span class="op">%&gt;%</span></span>
<span id="cb120-6"><a href="#cb120-6"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb120-7"><a href="#cb120-7"></a>            <span class="dt">resamples =</span> folds, <span class="co">#CV object</span></span>
<span id="cb120-8"><a href="#cb120-8"></a>            <span class="dt">grid =</span> rf_grid, <span class="co"># grid of values to try</span></span>
<span id="cb120-9"><a href="#cb120-9"></a>            <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse) </span>
<span id="cb120-10"><a href="#cb120-10"></a>  )</span>
<span id="cb120-11"><a href="#cb120-11"></a><span class="co"># turn off parallel cluster</span></span></code></pre></div>
</div>
<div id="random-forest-evaluation" class="section level3">
<h3>Random forest evaluation</h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co">#see a plot of performance for different tuning parameters</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>rf_tune_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># get the tuned model that performs best </span></span>
<span id="cb122-2"><a href="#cb122-2"></a>best_rf &lt;-<span class="st"> </span>rf_tune_res <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">select_best</span>(<span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="co"># finalize workflow with best model</span></span>
<span id="cb122-4"><a href="#cb122-4"></a>best_rf_wf &lt;-<span class="st"> </span>rf_wf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">finalize_workflow</span>(best_rf)</span>
<span id="cb122-5"><a href="#cb122-5"></a><span class="co"># fitting best performing model</span></span>
<span id="cb122-6"><a href="#cb122-6"></a>best_rf_fit &lt;-<span class="st"> </span>best_rf_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-7"><a href="#cb122-7"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb122-8"><a href="#cb122-8"></a>rf_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(best_rf_fit, train_data)</span></code></pre></div>
<p>Looking at important predictors. Looks like race and site are the only important ones here again (as no suprise)</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="co">#pull out the fit object</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>x &lt;-<span class="st"> </span>best_rf_fit<span class="op">$</span>fit<span class="op">$</span>fit<span class="op">$</span>fit</span>
<span id="cb123-3"><a href="#cb123-3"></a><span class="co">#plot variable importance</span></span>
<span id="cb123-4"><a href="#cb123-4"></a>vip<span class="op">::</span><span class="kw">vip</span>(x, <span class="dt">num_features =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Plotting observed/predicted and residuals. This one doesn’t look quite as terrible as the others.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="co">#predicted versus observed</span></span>
<span id="cb124-2"><a href="#cb124-2"></a><span class="kw">plot</span>(rf_pred<span class="op">$</span>.pred,train_data<span class="op">$</span>meters_ps)</span>
<span id="cb124-3"><a href="#cb124-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#45 degree line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co">#residuals</span></span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="kw">plot</span>(rf_pred<span class="op">$</span>.pred<span class="op">-</span>train_data<span class="op">$</span>meters_ps)</span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#straight line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<p>Looking at model performance.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>rf_perfomance &lt;-<span class="st"> </span>rf_tune_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="dt">n =</span> <span class="dv">1</span>)</span>
<span id="cb126-2"><a href="#cb126-2"></a><span class="kw">print</span>(rf_perfomance)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 9
##    mtry trees min_n .metric .estimator   mean     n std_err .config             
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1     6  1000    40 rmse    standard   0.0832    25 0.00117 Preprocessor1_Model…</code></pre>
</div>
</div>
<div id="finally-i-look-at-a-simple-model-with-only-our-main-predictor-and-our-outcome.-it-looks-like-the-rmse-is-pretty-much-the-same-with-only-team-in-there-which-says-that-it-is-not-doing-much-in-predicting-the-outcome." class="section level2">
<h2>Finally I look at a Simple Model with only our main predictor and our outcome. It looks like the RMSE is pretty much the same with only team in there, which says that it is not doing much in predicting the outcome.</h2>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="co"># Here I create a  recipe for the simple model fit with only our main predictor of interest.</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>fit_simple &lt;-<span class="st"> </span><span class="kw">recipe</span>(meters_ps <span class="op">~</span><span class="st"> </span>team_factor , <span class="dt">data =</span> train_data)</span>
<span id="cb128-3"><a href="#cb128-3"></a></span>
<span id="cb128-4"><a href="#cb128-4"></a></span>
<span id="cb128-5"><a href="#cb128-5"></a><span class="co"># Use the workflow() package to create a</span></span>
<span id="cb128-6"><a href="#cb128-6"></a><span class="co"># simple workflow that fits a  simple lm </span></span>
<span id="cb128-7"><a href="#cb128-7"></a></span>
<span id="cb128-8"><a href="#cb128-8"></a>wflow_simple &lt;-<span class="st"> </span></span>
<span id="cb128-9"><a href="#cb128-9"></a><span class="st">  </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-10"><a href="#cb128-10"></a><span class="st">  </span><span class="kw">add_model</span>(lm_mod) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-11"><a href="#cb128-11"></a><span class="st">  </span><span class="kw">add_recipe</span>(fit_simple)</span>
<span id="cb128-12"><a href="#cb128-12"></a></span>
<span id="cb128-13"><a href="#cb128-13"></a><span class="co"># Fitting the model</span></span>
<span id="cb128-14"><a href="#cb128-14"></a>fit_simple &lt;-<span class="st"> </span></span>
<span id="cb128-15"><a href="#cb128-15"></a><span class="st">  </span>wflow_simple <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-16"><a href="#cb128-16"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb128-17"><a href="#cb128-17"></a></span>
<span id="cb128-18"><a href="#cb128-18"></a><span class="co"># Extracting Model/Recipes with Parsnip</span></span>
<span id="cb128-19"><a href="#cb128-19"></a>fit_simple <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-20"><a href="#cb128-20"></a><span class="st">  </span><span class="kw">extract_fit_parsnip</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-21"><a href="#cb128-21"></a><span class="st">  </span><span class="kw">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 16 × 5
##    term                        estimate std.error statistic   p.value
##    &lt;chr&gt;                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)                  0.312      0.0756    4.12   0.0000600
##  2 team_factorGreen Ducks      -0.0731     0.0990   -0.739  0.461    
##  3 team_factorHazers            0.0517     0.107     0.484  0.629    
##  4 team_factorHornets          -0.0754     0.101    -0.750  0.455    
##  5 team_factorLimers           -0.0893     0.110    -0.813  0.418    
##  6 team_factorMellow Yellow     0.00341    0.102     0.0333 0.973    
##  7 team_factorMidnight Wisps   -0.0256     0.101    -0.254  0.800    
##  8 team_factorO&#39;rangers        -0.0886     0.102    -0.866  0.388    
##  9 team_factorRaspberry Racers -0.0470     0.102    -0.460  0.646    
## 10 team_factorRojo Rollers      0.00939    0.110     0.0855 0.932    
## 11 team_factorSavage Speeders  -0.0924     0.104    -0.885  0.377    
## 12 team_factorSnowballs        -0.0260     0.104    -0.249  0.804    
## 13 team_factorTeam Galactic    -0.0905     0.102    -0.884  0.378    
## 14 team_factorTeam Momo        -0.0659     0.113    -0.581  0.562    
## 15 team_factorTeam Primary     -0.0211     0.110    -0.192  0.848    
## 16 team_factorThunderbolts     -0.0665     0.104    -0.637  0.525</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="co"># Obtaining Predictions</span></span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="kw">predict</span>(fit_simple , train_data)</span></code></pre></div>
<pre><code>## # A tibble: 176 × 1
##    .pred
##    &lt;dbl&gt;
##  1 0.312
##  2 0.312
##  3 0.312
##  4 0.238
##  5 0.238
##  6 0.238
##  7 0.238
##  8 0.238
##  9 0.363
## 10 0.363
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>aug_simple &lt;-<span class="st"> </span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="st">  </span><span class="kw">augment</span>(fit_simple , train_data)</span>
<span id="cb132-3"><a href="#cb132-3"></a></span>
<span id="cb132-4"><a href="#cb132-4"></a>aug_simple <span class="op">%&gt;%</span></span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="st">  </span><span class="kw">select</span>(meters_ps)</span></code></pre></div>
<pre><code>## # A tibble: 176 × 1
##    meters_ps
##        &lt;dbl&gt;
##  1    0.0352
##  2    0.0382
##  3    0.0269
##  4    0.0384
##  5    0.0357
##  6    0.0387
##  7    0.0352
##  8    0.0270
##  9    0.0268
## 10    0.0357
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># Calculating Root RMSE </span></span>
<span id="cb134-2"><a href="#cb134-2"></a>rmse_train_simple &lt;-<span class="st"> </span>aug_simple <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-3"><a href="#cb134-3"></a><span class="st">  </span><span class="kw">rmse</span>(<span class="dt">truth =</span> meters_ps, .pred)</span>
<span id="cb134-4"><a href="#cb134-4"></a></span>
<span id="cb134-5"><a href="#cb134-5"></a></span>
<span id="cb134-6"><a href="#cb134-6"></a><span class="co">#COMPARING TO NULL MODEL </span></span>
<span id="cb134-7"><a href="#cb134-7"></a></span>
<span id="cb134-8"><a href="#cb134-8"></a><span class="co">#Looks like our model with all predictors does better than the null at reducing</span></span>
<span id="cb134-9"><a href="#cb134-9"></a><span class="co">#RMSE</span></span>
<span id="cb134-10"><a href="#cb134-10"></a></span>
<span id="cb134-11"><a href="#cb134-11"></a><span class="co">#Simple Model RMSE= 12.8</span></span>
<span id="cb134-12"><a href="#cb134-12"></a>rmse_train_simple</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       0.228</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="co">#Null Model RMSE = 14.41</span></span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="kw">print</span>(RMSE_null_train)</span></code></pre></div>
<pre><code>## [1] 0.2316689</code></pre>
</div>
<div id="final-fit.-the-lasso-had-the-lowest-rmse-so-lets-go-with-that-one-for-the-final-fit" class="section level2">
<h2>Final Fit. The LASSO had the lowest RMSE so let’s go with that one for the final fit/</h2>
</div>
</div>
<div id="final-model-evaluation" class="section level1">
<h1>Final Model Evaluation</h1>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a>final_fit &lt;-<span class="st"> </span>best_lasso_wf  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">last_fit</span>(data_split)</span></code></pre></div>
<p>Let’s look at the performance of the final fit, evaluated on the test data.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a>test_performance &lt;-<span class="st"> </span>final_fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect_metrics</span>()</span>
<span id="cb139-2"><a href="#cb139-2"></a><span class="kw">print</span>(test_performance)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard      0.0152 Preprocessor1_Model1
## 2 rsq     standard      0.996  Preprocessor1_Model1</code></pre>
<p>Looking at RMSE on test and train, we that they are similar, suggesting that we avoided overfitting.</p>
<p>If we compare the RMSE on the test data to the performance/RMSE of the null model on the test data, we see it’s not much better, showing that none of these models are good.</p>
<p>Diagnostic plots for test data.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a>test_predictions &lt;-<span class="st"> </span>final_fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect_predictions</span>()</span></code></pre></div>
<p>Plotting observed/predicted and residuals. This still doesn’t look great, but for some reason the residual plot is better</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="co">#predicted versus observed</span></span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="kw">plot</span>(test_predictions<span class="op">$</span>.pred,test_data<span class="op">$</span>meters_ps)</span>
<span id="cb142-3"><a href="#cb142-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#45 degree line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="co">#residuals</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="kw">plot</span>(test_predictions<span class="op">$</span>.pred<span class="op">-</span>test_data<span class="op">$</span>meters_ps)</span>
<span id="cb143-3"><a href="#cb143-3"></a><span class="kw">abline</span>(<span class="dt">a=</span><span class="dv">0</span>,<span class="dt">b=</span><span class="dv">0</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co">#straight line, along which the results should fall</span></span></code></pre></div>
<p><img src="tidytuesday_exercise2_files/figure-html/unnamed-chunk-30-2.png" width="672" /> ## From the last fit we see that the RMSE was 0.01519064 while it was 0.01564391 on the train data.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
